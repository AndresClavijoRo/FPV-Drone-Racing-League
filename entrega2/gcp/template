gcloud auth list

gcloud config set project elated-coil-323901

gcloud beta compute instance-templates create ifpv-web-server \
 --project=elated-coil-323901 \
 --machine-type=e2-small \
 --network-interface=network=default,network-tier=PREMIUM \
 --instance-template-region=us-central1 \
 --no-restart-on-failure \
 --maintenance-policy=TERMINATE \
 --provisioning-model=SPOT \
 --instance-termination-action=STOP \
 --scopes=https://www.googleapis.com/auth/devstorage.read_only,https://www.googleapis.com/auth/logging.write,https://www.googleapis.com/auth/monitoring.write,https://www.googleapis.com/auth/servicecontrol,https://www.googleapis.com/auth/service.management.readonly,https://www.googleapis.com/auth/trace.append \
 --create-disk=boot=yes,device-name=ifpv-web-server,image=projects/ubuntu-os-cloud/global/images/ubuntu-2004-focal-v20240307b,mode=rw,size=10,type=pd-balanced,auto-delete=yes \
 --no-shielded-secure-boot \
 --shielded-vtpm \
 --shielded-integrity-monitoring \
 --reservation-affinity=any \
 --tags=network-lb-tag-ifpv \
 --metadata=startup-script='
#!/bin/bash
# PASO 0 ACTUALIZAR REPOSITORIOS
apt-get update

# PASO 1 INSTALA GIT
sudo apt-get install -y git

# PASO 2 INSTALAR DOCKER
sudo apt-get install -y docker.io

# PASO 3 INSTALAR DOCKER COMPOSE
sudo apt-get install -y docker-compose

# PASO 4 CLONAR REPOSITORIO
git clone https://github.com/AndresClavijoRo/FPV-Drone-Racing-League.git -b load_balancer

# PASO 5 INGRESAR A LA CARPETA DEL PROYECTO
cd FPV-Drone-Racing-League/entrega2

# PASO 6 EJECUTAR DOCKER COMPOSE
sudo docker-compose up -d
'

gcloud compute firewall-rules create ifpv-fw \
    --target-tags network-lb-tag-ifpv --allow tcp:8000


gcloud beta compute health-checks create tcp ifpv-health-check \
    --project=elated-coil-323901 \
    --port=5000 \
    --proxy-header=NONE \
    --no-enable-logging \
    --check-interval=10 \
    --timeout=5 \
    --unhealthy-threshold=3 \
    --healthy-threshold=2 
gcloud beta compute instance-groups managed create ifpv-group \
    --project=elated-coil-323901 \
    --base-instance-name=ifpv-group \
    --template=projects/elated-coil-323901/regions/us-central1/instanceTemplates/ifpv-web-server --size=1 --zones=us-central1-c,us-central1-f,us-central1-b \
    --target-distribution-shape=EVEN \
    --instance-redistribution-type=PROACTIVE \
    --default-action-on-vm-failure=repair \
    --health-check=projects/elated-coil-323901/global/healthChecks/ifpv-health-check \
    --initial-delay=300 \
    --no-force-update-on-repair \
    --standby-policy-mode=manual \
    --list-managed-instances-results=PAGELESS 
gcloud beta compute instance-groups managed set-autoscaling ifpv-group \
    --project=elated-coil-323901 \
    --region=us-central1 \
    --mode=on \
    --min-num-replicas=1 \
    --max-num-replicas=5 \
    --target-cpu-utilization=0.7 \
    --cool-down-period=60

gcloud compute addresses create lb-ifpv-1 \
    --ip-version=IPV4 \
    --network-tier=PREMIUM \
    --global
	
gcloud compute addresses describe lb-ifpv-1 \
    --format="get(address)" \
    --global	
	
gcloud compute health-checks create http http-basic-check \
    --port 80 	
	
gcloud compute backend-services create web-backend-service \
    --load-balancing-scheme=EXTERNAL \
    --protocol=HTTP \
    --port-name=http \
    --health-checks=http-basic-check \
    --global	